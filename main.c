/*
 * PB12(SPI2_NSS)  -> MAX7219 CS
 * PB13(SPI2_SCK)  -> MAX7219 CLK
 * PB14(SPI2_MISO) -> N/A
 * PB15(SPI2_MOSI) -> MAX7219 DIN
 */

#include "stm32f10x.h"
#include "max7219.h"

void delay(int i) {
	while (i) {
		i--;
	}
}

u8 font5x7[11][6] = {
  {0x3e,0x41,0x41,0x41,0x3e,0x00}, // 0
  {0x00,0x21,0x7f,0x01,0x00,0x00}, // 1
  {0x21,0x43,0x45,0x49,0x31,0x00}, // 2
  {0x22,0x41,0x49,0x49,0x36,0x00}, // 3
  {0x0c,0x14,0x24,0x7f,0x04,0x00}, // 4
  {0x72,0x51,0x51,0x51,0x4e,0x00}, // 5
  {0x3e,0x49,0x49,0x49,0x06,0x00}, // 6
  {0x40,0x47,0x48,0x50,0x60,0x00}, // 7
  {0x36,0x49,0x49,0x49,0x36,0x00}, // 8
  {0x30,0x49,0x49,0x49,0x3e,0x00}, // 9
  {0x00,0x00,0x00,0x00,0x00,0x00}, // black
};

int main(void) {
	u8 i;
	USART1_Init();
	
	MAX7219_Init();
	
	for (i=0;i<5;i++) {
		MAX7219_SetBuffer(0+i, font5x7[0][i]);
	}

	for (i=0;i<5;i++) {
		MAX7219_SetBuffer(6+i, font5x7[1][i]);
  	}

	for (i=0;i<5;i++) {
		MAX7219_SetBuffer(12+i, font5x7[2][i]);
	}

	for (i=0;i<5;i++) {
		MAX7219_SetBuffer(18+i, font5x7[3][i]);
	}
	
	for (i=0;i<5;i++) {
		MAX7219_SetBuffer(24+i, font5x7[4][i]);
	}
	
	MAX7219_Flush();
	while (1) {
		delay(10000000);
	}
}

